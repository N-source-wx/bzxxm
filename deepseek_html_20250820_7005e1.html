<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>海棠礦工活動 - 慕慕計算器 (v1.4)</title>
    <style>
        :root {
            --primary: #4a6fa5;
            --secondary: #6e9887;
            --accent: #e76f51;
            --light: #f8f9fa;
            --dark: #2d3e50;
            --success: #2a9d8f;
            --warning: #e9c46a;
            --danger: #e76f51;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
            padding: 20px;
        }
        
        .container {
            max-width: 1800px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 20px;
            text-align: center;
        }
        
        h1 {
            font-size: 28px;
            margin-bottom: 5px;
        }
        
        .description {
            font-size: 12px;
            opacity: 0.8;
            font-style: italic;
        }
        
        .calculator-container {
            display: flex;
            flex-wrap: wrap;
            padding: 20px;
            gap: 20px;
        }
        
        .panel {
            flex: 1;
            min-width: 300px;
            background: var(--light);
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
        }
        
        .panel-title {
            font-size: 18px;
            color: var(--primary);
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--secondary);
        }
        
        .input-group {
            margin-bottom: 15px;
        }
        
        .input-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .input-row label {
            margin-bottom: 0;
            flex: 1;
        }
        
        .input-row input {
            width: 80px;
            text-align: right;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: var(--dark);
        }
        
        input[type="number"], input[type="text"], select {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        
        button {
            background: var(--primary);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            transition: background 0.3s;
        }
        
        button:hover {
            background: var(--secondary);
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        
        th, td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        
        th {
            background-color: var(--primary);
            color: white;
        }
        
        tr:nth-child(even) {
            background-color: #f2f2f2;
        }
        
        tr.current-level {
            background-color: var(--warning);
            font-weight: bold;
        }
        
        .result-box {
            background: #e9f7ef;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
        }
        
        .result-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }
        
        .result-value {
            font-weight: 600;
            color: var(--success);
        }
        
        .day-columns {
            display: flex;
            gap: 10px;
            overflow-x: auto;
            padding-bottom: 10px;
        }
        
        .day-column {
            min-width: 120px;
            background: white;
            padding: 10px;
            border-radius: 6px;
            border: 1px solid #ddd;
        }
        
        .day-input {
            width: 80px !important;
        }
        
        .day-title {
            text-align: center;
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--primary);
        }
        
        .package-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            padding: 8px;
            background: white;
            border-radius: 6px;
            border: 1px solid #eee;
        }
        
        .exp-input {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .exp-input input {
            width: 60px;
            text-align: center;
        }
        
        @media (max-width: 1200px) {
            .calculator-container {
                flex-direction: column;
            }
            
            .panel {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>海棠礦工活動 - 慕慕計算器 (v1.4)</h1>
            <p class="description">本計算結果僅供參考</p>
        </header>
        
        <div class="calculator-container">
            <!-- 第一欄：當前狀態和總經驗計算 -->
            <div class="panel">
                <h2 class="panel-title">當前狀態與總經驗計算</h2>
                
                <div class="input-row">
                    <label for="current-hooks">目前鉤子數量</label>
                    <input type="number" id="current-hooks" value="0" min="0">
                </div>
                
                <div class="input-row">
                    <label for="current-bombs">目前炸彈數量</label>
                    <input type="number" id="current-bombs" value="0" min="0">
                </div>
                
                <div class="input-row">
                    <label for="current-exp">目前經驗分數</label>
                    <input type="number" id="current-exp" value="0" min="0">
                </div>
                
                <div class="result-box">
                    <h3>經驗預估</h3>
                    
                    <div class="input-row">
                        <label for="hook-exp-value">1鉤子經驗</label>
                        <input type="number" id="hook-exp-value" value="15" min="10" max="18">
                    </div>
                    
                    <div class="result-item">
                        <span>預估獲得鉤子數量／經驗:</span>
                        <span id="hook-result" class="result-value">0／0</span>
                    </div>
                    
                    <div class="result-item">
                        <span>預估獲得炸彈數量／經驗:</span>
                        <span id="bomb-result" class="result-value">0／0</span>
                    </div>
                    
                    <div class="result-item">
                        <span>預估消費葉子:</span>
                        <span id="total-leaves" class="result-value">0</span>
                    </div>
                    
                    <div class="result-item">
                        <span>預估累計總經驗:</span>
                        <span id="total-exp" class="result-value">0</span>
                    </div>
                    
                    <div class="result-item">
                        <span>預估達到等級與獎勵:</span>
                        <span id="estimated-level" class="result-value">LV1 - 門派玉牌*5</span>
                    </div>
                </div>
            </div>
            
            <!-- 第二欄：等級獎勵表格 -->
            <div class="panel">
                <h2 class="panel-title">等級獎勵對照表</h2>
                <div class="table-container">
                    <table id="reward-table">
                        <thead>
                            <tr>
                                <th>等級</th>
                                <th>升級經驗</th>
                                <th>總經驗</th>
                                <th>獎勵</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- 等級數據將通過JavaScript動態生成 -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- 第三欄：每日消費計算 -->
            <div class="panel">
                <h2 class="panel-title">每日消費計算 (7天)</h2>
                <p>每天可買炸彈 0-100 個，1個10葉</p>
                
                <div class="day-columns">
                    <!-- 7天的輸入區域將通過JavaScript動態生成 -->
                </div>
                
                <div class="result-box">
                    <h3>每日消費總計</h3>
                    <div class="result-item">
                        <span>總鉤子數量:</span>
                        <span id="daily-hooks" class="result-value">0</span>
                    </div>
                    <div class="result-item">
                        <span>總炸彈數量:</span>
                        <span id="daily-bombs" class="result-value">0</span>
                    </div>
                    <div class="result-item">
                        <span>總消費葉子:</span>
                        <span id="daily-leaves" class="result-value">0</span>
                    </div>
                </div>
            </div>
            
            <!-- 第四欄：累計儲值計算 -->
            <div class="panel">
                <h2 class="panel-title">累計儲值計算</h2>
                <div class="input-group">
                    <label for="total-topup">累計儲值葉子數量</label>
                    <select id="total-topup">
                        <option value="0">0</option>
                        <option value="300">300</option>
                        <option value="600">600</option>
                        <option value="1000">1000</option>
                        <option value="2000">2000</option>
                        <option value="4000">4000</option>
                        <option value="9000">9000</option>
                        <option value="14000">14000</option>
                        <option value="20000">20000</option>
                        <option value="28000">28000</option>
                        <option value="40000">40000</option>
                        <option value="60000">60000</option>
                        <option value="70000">70000</option>
                    </select>
                </div>
                
                <div class="result-box">
                    <h3>儲值獎勵</h3>
                    <div class="result-item">
                        <span>可獲得鉤子:</span>
                        <span id="topup-hooks" class="result-value">0</span>
                    </div>
                </div>
            </div>
            
            <!-- 第五欄：超值禮包選擇 -->
            <div class="panel">
                <h2 class="panel-title">超值禮包選擇</h2>
                
                <div id="package-list">
                    <!-- 禮包選項將通過JavaScript動態生成 -->
                </div>
                
                <div class="result-box">
                    <h3>禮包總計</h3>
                    <div class="result-item">
                        <span>可獲得鉤子:</span>
                        <span id="package-hooks" class="result-value">0</span>
                    </div>
                    <div class="result-item">
                        <span>總花費:</span>
                        <span id="package-cost" class="result-value">0 NTD</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 等級數據
        const levelData = [
            { level: 1, expRequired: 50, totalExp: 50, reward: "門派玉牌*5" },
            { level: 2, expRequired: 50, totalExp: 100, reward: "英雄酒*5" },
            { level: 3, expRequired: 100, totalExp: 200, reward: "天之隕星*3" },
            { level: 4, expRequired: 100, totalExp: 300, reward: "紫雲金*4" },
            { level: 5, expRequired: 200, totalExp: 500, reward: "萌萌果*30" },
            { level: 6, expRequired: 200, totalExp: 700, reward: "3級自選寶石*1" },
            { level: 7, expRequired: 200, totalExp: 900, reward: "自選紅色卡牌*1" },
            { level: 8, expRequired: 250, totalExp: 1150, reward: "幻夢袍*2 (弟子金服裝)" },
            { level: 9, expRequired: 250, totalExp: 1400, reward: "坐騎琥珀寶箱*2" },
            { level: 10, expRequired: 250, totalExp: 1650, reward: "翅膀羽毛寶箱*2" },
            { level: 11, expRequired: 350, totalExp: 2000, reward: "橙色化身自選寶箱*1" },
            { level: 12, expRequired: 350, totalExp: 2350, reward: "通世法寶碎片(天地劍)*10" },
            { level: 13, expRequired: 350, totalExp: 2700, reward: "曹正淳碎片*20" },
            { level: 14, expRequired: 450, totalExp: 3150, reward: "黃神機圖紙*1" },
            { level: 15, expRequired: 450, totalExp: 3600, reward: "紅神機碎片*10" },
            { level: 16, expRequired: 450, totalExp: 4050, reward: "神珍鐵*100" },
            { level: 17, expRequired: 600, totalExp: 4650, reward: "神機木*100" },
            { level: 18, expRequired: 600, totalExp: 5250, reward: "神機齒輪*1" },
            { level: 19, expRequired: 600, totalExp: 5850, reward: "4級自選寶石*1" },
            { level: 20, expRequired: 800, totalExp: 6650, reward: "彩色自選神兵碎片*20" },
            { level: 21, expRequired: 800, totalExp: 7450, reward: "紅神機圖紙*1" },
            { level: 22, expRequired: 800, totalExp: 8250, reward: "兵器核心*100" },
            { level: 23, expRequired: 1000, totalExp: 9250, reward: "仙刻刀*30" },
            { level: 24, expRequired: 1000, totalExp: 10250, reward: "通用彩色法寶升星碎片*20" },
            { level: 25, expRequired: 1000, totalExp: 11250, reward: "仙靈之石*200" },
            { level: 26, expRequired: 1200, totalExp: 12450, reward: "紅玉*1" },
            { level: 27, expRequired: 1200, totalExp: 13650, reward: "造化仙經*15" },
            { level: 28, expRequired: 1200, totalExp: 14850, reward: "星君神酒*5" },
            { level: 29, expRequired: 1350, totalExp: 16200, reward: "隨機黃色靈珠袋*1" },
            { level: 30, expRequired: 1350, totalExp: 17550, reward: "彩品自選門客碎片*10" },
            { level: 31, expRequired: 1350, totalExp: 18900, reward: "絕世匠神之錘*30" },
            { level: 32, expRequired: 1350, totalExp: 20250, reward: "彩弟子雲羅郡主" },
            { level: 33, expRequired: 1350, totalExp: 21600, reward: "彩色弟子袍*1" },
            { level: 34, expRequired: 1350, totalExp: 22950, reward: "彩品隨機弟子功法*1" },
            { level: 35, expRequired: 1350, totalExp: 24300, reward: "天罡陣*1" },
            { level: 36, expRequired: 1350, totalExp: 25650, reward: "高級仙火*10" },
            { level: 37, expRequired: 1350, totalExp: 27000, reward: "7級自選寶石*1" },
            { level: 38, expRequired: 1350, totalExp: 28350, reward: "極品定緣珠*1" },
            { level: 39, expRequired: 1350, totalExp: 29700, reward: "自選境界神通*10" },
            { level: 40, expRequired: 0, totalExp: 29700, reward: "平天力王化身" }
        ];

        // 儲值獎勵數據
        const topupRewards = [
            { leaves: 300, hooks: 20 },
            { leaves: 600, hooks: 30 },
            { leaves: 1000, hooks: 50 },
            { leaves: 2000, hooks: 70 },
            { leaves: 4000, hooks: 100 },
            { leaves: 9000, hooks: 200 },
            { leaves: 14000, hooks: 250 },
            { leaves: 20000, hooks: 250 },
            { leaves: 28000, hooks: 300 },
            { leaves: 40000, hooks: 400 },
            { leaves: 60000, hooks: 400 }
        ];

        // 消費獎勵級距
        const consumptionRewards = [
            { leaves: 200, hooks: 3 },
            { leaves: 500, hooks: 3 },
            { leaves: 1000, hooks: 5 },
            { leaves: 2000, hooks: 10 },
            { leaves: 4000, hooks: 20 },
            { leaves: 6000, hooks: 40 },
            { leaves: 9500, hooks: 60 },
            { leaves: 18000, hooks: 90 }
        ];

        // 禮包數據
        const packages = [
            { name: "0.99美金禮包", price: 30, hooks: 10, limit: 1 },
            { name: "4.99美金禮包", price: 150, hooks: 10, limit: 3 },
            { name: "14.99美金禮包", price: 432, hooks: 15, limit: 3 },
            { name: "19.99美金禮包", price: 590, hooks: 20, limit: 4 },
            { name: "99.99美金禮包", price: 2896, hooks: 70, limit: 3 }
        ];

        // 初始化函數
        function init() {
            // 生成等級表格
            generateLevelTable();
            
            // 生成每日輸入區域
            generateDailyInputs();
            
            // 生成禮包選擇區域
            generatePackageOptions();
            
            // 添加事件監聽器
            document.getElementById('current-exp').addEventListener('input', updateAllCalculations);
            document.getElementById('current-hooks').addEventListener('input', updateAllCalculations);
            document.getElementById('current-bombs').addEventListener('input', updateAllCalculations);
            document.getElementById('total-topup').addEventListener('change', updateAllCalculations);
            document.getElementById('hook-exp-value').addEventListener('input', updateAllCalculations);
            
            // 初始計算
            updateAllCalculations();
        }

        // 生成等級表格
        function generateLevelTable() {
            const tableBody = document.querySelector('#reward-table tbody');
            tableBody.innerHTML = '';
            
            levelData.forEach(data => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>LV${data.level}</td>
                    <td>${data.expRequired}</td>
                    <td>${data.totalExp}</td>
                    <td>${data.reward}</td>
                `;
                tableBody.appendChild(row);
            });
        }

        // 生成每日輸入區域
        function generateDailyInputs() {
            const dayColumns = document.querySelector('.day-columns');
            dayColumns.innerHTML = '';
            
            for (let day = 1; day <= 7; day++) {
                const column = document.createElement('div');
                column.className = 'day-column';
                column.innerHTML = `
                    <div class="day-title">第${day}天</div>
                    <div class="input-group">
                        <label for="day-${day}-bombs">炸彈數量</label>
                        <input type="number" id="day-${day}-bombs" value="0" min="0" max="100" data-day="${day}" class="day-input">
                    </div>
                    <div class="input-group">
                        <label for="day-${day}-leaves">消費葉子</label>
                        <input type="number" id="day-${day}-leaves" value="0" min="0" data-day="${day}" class="day-input">
                    </div>
                    <div class="result-item">
                        <span>獲得鉤子:</span>
                        <span id="day-${day}-hooks" class="result-value">0</span>
                    </div>
                `;
                dayColumns.appendChild(column);
                
                // 添加事件監聽
                document.getElementById(`day-${day}-bombs`).addEventListener('input', updateAllCalculations);
                document.getElementById(`day-${day}-leaves`).addEventListener('input', updateAllCalculations);
            }
        }

        // 生成禮包選擇區域
        function generatePackageOptions() {
            const packageList = document.getElementById('package-list');
            packageList.innerHTML = '';
            
            packages.forEach((pkg, index) => {
                const item = document.createElement('div');
                item.className = 'package-item';
                item.innerHTML = `
                    <div>
                        <input type="checkbox" id="package-${index}" data-index="${index}">
                        <label for="package-${index}">${pkg.name}</label>
                    </div>
                    <div>
                        <input type="number" id="package-${index}-qty" value="0" min="0" max="${pkg.limit}" style="width: 60px;" data-index="${index}">
                    </div>
                `;
                packageList.appendChild(item);
                
                // 添加事件監聽
                document.getElementById(`package-${index}`).addEventListener('change', updateAllCalculations);
                document.getElementById(`package-${index}-qty`).addEventListener('input', updateAllCalculations);
            });
        }

        // 計算消費葉子可獲得的鉤子數量
        function calculateHooksFromLeaves(leaves) {
            let totalHooks = 0;
            for (const reward of consumptionRewards) {
                if (leaves >= reward.leaves) {
                    totalHooks += reward.hooks;
                }
            }
            return totalHooks;
        }

        // 更新每日計算
        function updateDailyCalculations() {
            let totalDailyHooks = 0;
            let totalDailyBombs = 0;
            let totalDailyLeaves = 0;
            
            for (let day = 1; day <= 7; day++) {
                const bombs = parseInt(document.getElementById(`day-${day}-bombs`).value) || 0;
                const leaves = parseInt(document.getElementById(`day-${day}-leaves`).value) || 0;
                
                // 計算當天可獲得的鉤子 (消費獎勵)
                const hooksFromLeaves = calculateHooksFromLeaves(leaves);
                
                // 更新當天鉤子顯示
                document.getElementById(`day-${day}-hooks`).textContent = hooksFromLeaves;
                
                // 累加總計
                totalDailyHooks += hooksFromLeaves;
                totalDailyBombs += bombs;
                totalDailyLeaves += leaves;
            }
            
            // 更新每日總計顯示
            document.getElementById('daily-hooks').textContent = totalDailyHooks;
            document.getElementById('daily-bombs').textContent = totalDailyBombs;
            document.getElementById('daily-leaves').textContent = totalDailyLeaves;
            
            return { hooks: totalDailyHooks, bombs: totalDailyBombs, leaves: totalDailyLeaves };
        }

        // 更新儲值計算
        function updateTopupCalculation() {
            const totalTopup = parseInt(document.getElementById('total-topup').value) || 0;
            let totalHooks = 0;
            
            // 計算可獲得的鉤子獎勵
            for (const reward of topupRewards) {
                if (totalTopup >= reward.leaves) {
                    totalHooks += reward.hooks;
                }
            }
            
            // 更新顯示
            document.getElementById('topup-hooks').textContent = totalHooks;
            
            return totalHooks;
        }

        // 更新禮包計算
        function updatePackageCalculation() {
            let totalHooks = 0;
            let totalCost = 0;
            
            packages.forEach((pkg, index) => {
                const checkbox = document.getElementById(`package-${index}`);
                const quantityInput = document.getElementById(`package-${index}-qty`);
                
                if (checkbox.checked) {
                    const quantity = parseInt(quantityInput.value) || 0;
                    const validQuantity = Math.min(quantity, pkg.limit);
                    totalHooks += validQuantity * pkg.hooks;
                    totalCost += validQuantity * pkg.price;
                }
            });
            
            // 更新顯示
            document.getElementById('package-hooks').textContent = totalHooks;
            document.getElementById('package-cost').textContent = `${totalCost} NTD`;
            
            return totalHooks;
        }

        // 更新總計計算
        function updateTotalCalculation() {
            const currentExp = parseInt(document.getElementById('current-exp').value) || 0;
            const currentHooks = parseInt(document.getElementById('current-hooks').value) || 0;
            const currentBombs = parseInt(document.getElementById('current-bombs').value) || 0;
            const hookExpRatio = parseInt(document.getElementById('hook-exp-value').value) || 15;
            
            const daily = updateDailyCalculations();
            const topupHooks = updateTopupCalculation();
            const packageHooks = updatePackageCalculation();
            
            // 計算總資源
            const estimatedHooks = daily.hooks + topupHooks + packageHooks;
            const estimatedBombs = daily.bombs;
            const totalLeaves = daily.leaves;
            
            // 計算總經驗（包含目前鉤子和炸彈）
            const expFromCurrentHooks = currentHooks * hookExpRatio;
            const expFromCurrentBombs = currentBombs * 10;
            const expFromEstimatedHooks = estimatedHooks * hookExpRatio;
            const expFromEstimatedBombs = estimatedBombs * 10;
            const totalExp = currentExp + expFromCurrentHooks + expFromCurrentBombs + expFromEstimatedHooks + expFromEstimatedBombs;
            
            // 計算預估等級和獎勵
            let estimatedLevel = 1;
            let estimatedReward = "";
            for (let i = levelData.length - 1; i >= 0; i--) {
                if (totalExp >= levelData[i].totalExp) {
                    estimatedLevel = levelData[i].level;
                    estimatedReward = levelData[i].reward;
                    break;
                }
            }
            
            // 更新顯示
            document.getElementById('hook-result').textContent = `${estimatedHooks}／${expFromEstimatedHooks}`;
            document.getElementById('bomb-result').textContent = `${estimatedBombs}／${expFromEstimatedBombs}`;
            document.getElementById('total-leaves').textContent = totalLeaves;
            document.getElementById('total-exp').textContent = totalExp;
            document.getElementById('estimated-level').textContent = `LV${estimatedLevel} - ${estimatedReward}`;
            
            return { 
                hooks: estimatedHooks, 
                bombs: estimatedBombs, 
                leaves: totalLeaves, 
                totalExp, 
                level: estimatedLevel,
                reward: estimatedReward
            };
        }

        // 高亮當前等級 - 修正後的版本
        function highlightCurrentLevel() {
            const totalExp = parseInt(document.getElementById('total-exp').textContent) || 0;
            const rows = document.querySelectorAll('#reward-table tbody tr');
            
            // 先移除所有高亮
            rows.forEach(row => {
                row.classList.remove('current-level');
            });
            
            // 找到並高亮當前等級
            for (let i = 0; i < levelData.length; i++) {
                if (totalExp >= levelData[i].totalExp) {
                    // 如果是最後一級或者下一級的要求達不到
                    if (i === levelData.length - 1 || totalExp < levelData[i + 1].totalExp) {
                        rows[i].classList.add('current-level');
                        break;
                    }
                }
            }
        }

        // 更新所有計算
        function updateAllCalculations() {
            updateTotalCalculation();
            highlightCurrentLevel();
        }

        // 頁面載入時初始化
        window.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>